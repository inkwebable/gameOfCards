<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Card/Card.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Card/Card.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class
 * Generate a Card
 */
class Card {
  constructor(options) {
    const defaultOptions = {
      name: '',
      value: 0,
      suit: '',
      image: '',
      imageDefault: 'front',
      cardColor: '',
      visible: false,
      allowFlip: true,
      clickable: true,
      movable: true,
      moving: false,
      droppable: false,
      inArea: null,
      transitioning: false,
      faceUp: false,
      faceDown: true,
      currentEvent: null,
      events: {
        click: () => {
        },
        transitionend: () => {
        },
      },
      onClick: (evt) => {
      },
      onCardFaceUp: () => {
      },
      onCardFaceDown: () => {
      },
    };

    let newOptions = Object.assign({}, defaultOptions, options);
    // console.log('create card', newOptions.events);

    Object.defineProperties(this, {
      '_id': {
        value: newOptions.id || undefined,
        writable: false,
      },
    });

    this.name = newOptions.name || '';
    this.value = newOptions.value || 0;
    this.suit = newOptions.suit || '';
    this.image = newOptions.image || '';
    this.imageDefault = newOptions.imageDefault;
    this.cardColor = newOptions.cardColor || '';
    this.visible = newOptions.visible || false;
    this.allowFlip = newOptions.allowFlip || true;
    this.clickable = newOptions.clickable || true;
    this.movable = newOptions.movable || true;
    this.moving = newOptions.moving || false;
    this.droppable = newOptions.droppable || false;
    this.inArea = newOptions.inArea || null;
    this.transitioning = newOptions.transitioning || false;
    this.faceUp = newOptions.faceUp || false;
    this.faceDown = newOptions.faceDown || true;
    this.currentEvent = newOptions.currentEvent || null;
    this.events = newOptions.events || {};
    this.onClick = newOptions.onClick || ((evt) => {
    });
    this.onCardFaceUp = newOptions.onCardFaceUp || ((evt) => {
    });
    this.onCardFaceDown = newOptions.onCardFaceDown || ((evt) => {
    });
  }

  setDom(dom) {
    Object.defineProperty(this, 'dom', {
      value: dom,
      writable: false,
    });
  }

  setDOMClassContainer(val) {
    this.dom.className = val;
  }

  addDOMClassContainer(val) {
    this.dom.className += ` ${val}`;
  }

  setDOMClassCard(val) {
    this.dom.children[0].className = val;
  }

  addDOMClassCard(val) {
    this.dom.children[0].className += ` ${val}`;
  }

  setClickEvent(onClick, props, activateListener = true) {
    this.onClick = onClick.bind(this, props);

    if (activateListener) {
      this.activateClickEventListener();
    }

    return this.onClick;
  }

  setTransitionEvent({ onCardFaceUp, onCardFaceDown }, props, activateListener = true) {
    if (onCardFaceUp) {
      this.onCardFaceUp = onCardFaceUp.bind(this, props);
    }

    if (onCardFaceDown) {
      this.onCardFaceDown = onCardFaceDown.bind(this, props);
    }

    if (activateListener) {
      this.activateTransitionedEventListener();
    }
  }

  activateClickEventListener() {
    this.clearClickListener();
    this.events.click = this.onClick;
    this.dom.addEventListener('click', this.events.click);
  }

  activateTransitionedEventListener() {
    this.clearTransitionedListener();
    this.events.transitionend = this._afterTransition.bind(this);
    this.dom.addEventListener('transitionend', this.events.transitionend);
  }

  activateAllEventListeners() {
    console.log('core/Card activateAllEvents', this);
    this.removeAllEventListeners();

    this.activateClickEventListener();
    this.activateTransitionedEventListener();
  }

  removeAllEventListeners() {
    this.clearClickListener();
    this.clearTransitionedListener();
  }

  // Dynamically remove all events
  removeAllEvents() {
    console.log('core/Card removeAllEvents', this);
    const removed = [];

    for (let event in this.events) {
      if (this.clearEvent(event)) {
        removed.push(`${event} removed`);
        this.events[event] = () => {
        };
      } else {
        console.error(`${event}event not removed from card ${this._id}`);
      }
    }

    return removed;
  }

  /**
   * Remove the given event listener from the card
   */
  clearEvent(event) {
    if ({}.hasOwnProperty.call(this.events, event)) {
      this.dom.removeEventListener(event, this.events[event]);

      return true
    }

    return false;
  }

  /**
   * Remove the click event from the card
   */
  clearClickListener(event = this.events.click) {
    this.dom.removeEventListener('click', event);
  }

  /**
   * Remove the transitioned event from the card
   */
  clearTransitionedListener(event = this.events.transitionend) {
    this.dom.removeEventListener('transitionend', event);
  }

  /**
   * Flip a card face up
   *
   * @returns {boolean}
   */
  flipCardFaceUp() {
    this.currentEvent = 'flipCardFaceUp';

    if (!this.visible) {
      this.dom.querySelector('.front img').src = this.image;
      this.addDOMClassCard(' flipped');
      this.transitioning = true;

      return true;
    }

    return false;
  }

  /**
   * Flip a card face down
   *
   * @returns {boolean}
   */
  flipCardFaceDown() {
    this.currentEvent = 'flipCardFaceDown';

    if (this.visible) {
      this.setDOMClassCard('card');
      this.transitioning = true;

      return true
    }

    return false;
  }

  /**
   * Handle transition end events
   *
   * @param evt
   */
  _afterTransition(evt) {
    console.log('aftertran', this, evt)
    this.transitioning = false;

    if (this.currentEvent === 'flipCardFaceUp') {
      this.visible = true;
      this.onCardFaceUp(evt);
    }

    if (this.currentEvent === 'flipCardFaceDown') {
      this.visible = false;
      this.onCardFaceDown(evt);
      this.clearFrontFaceImg();
    }

    // @TODO allow adding of custom event after transition?
  }

  /**
   * Reset the src for front of the card
   *
   * @param img
   */
  clearFrontFaceImg(img = this.imageDefault) {
    this.dom.querySelector('.front img').src = `${img}`;
  }

  isTransitioning() {
    return this.transitioning === true;
  }
}

export default Card;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Card.html">Card</a></li><li><a href="DefaultPlayer.html">DefaultPlayer</a></li><li><a href="module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addDeckToDecks">addDeckToDecks</a></li><li><a href="global.html#addDeckToDOM">addDeckToDOM</a></li><li><a href="global.html#addDeckToDom">addDeckToDom</a></li><li><a href="global.html#addPlayerToPlayers">addPlayerToPlayers</a></li><li><a href="global.html#createDealer">createDealer</a></li><li><a href="global.html#createDeck">createDeck</a></li><li><a href="global.html#createDeckObj">createDeckObj</a></li><li><a href="global.html#createPlayer">createPlayer</a></li><li><a href="global.html#createStandardDeck">createStandardDeck</a></li><li><a href="global.html#findCardById">findCardById</a></li><li><a href="global.html#findDeckById">findDeckById</a></li><li><a href="global.html#findPlayerByName">findPlayerByName</a></li><li><a href="global.html#makeDomDeck">makeDomDeck</a></li><li><a href="global.html#newNumber">newNumber</a></li><li><a href="global.html#shuffleCardsObj">shuffleCardsObj</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Wed May 20 2020 20:11:18 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
